<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Tools Directory</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121833;
      --ink: #e7eaf6;
      --muted: #a8b0d9;
      --accent: #6ea8fe;
      --danger: #ff6b6b;
      --ok: #30db7d;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, #0b1020, #0e1430 40%, #0b1020);
      color: var(--ink);
      min-height: 100svh;
    }
    .wrap { max-width: 1000px; margin: 0 auto; padding: 16px; display:none; }
    header { display: grid; gap: 8px; margin-bottom: 16px; align-items:center; grid-template-columns: 1fr auto; }
    h1 { font-weight: 700; margin: 0; font-size: 22px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 840px){ .row { grid-template-columns: 1fr 360px; align-items: start; } }
    .panel { background: var(--panel); border: 1px solid #1f2650; border-radius: 14px; }
    .panel .hd { padding: 14px 16px; border-bottom: 1px solid #1c2347; display:flex; align-items:center; justify-content:space-between; }
    .panel .bd { padding: 14px 16px; }
    input[type="text"], input[type="url"], input[type="email"], input[type="password"], textarea {
      width: 100%; padding: 11px 12px; border-radius: 10px;
      border: 1px solid #2a346b; background:#0e1430; color: var(--ink);
      outline: none; font-size: 15px;
    }
    input::placeholder, textarea::placeholder { color: #6d75a8; }
    textarea { min-height: 96px; resize: vertical; }
    .tools { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 600px){ .tools { grid-template-columns: 1fr 1fr; } }
    .tool { background:#0e1430; border:1px solid #202753; border-radius:12px; padding:12px; display:grid; gap:6px; }
    .tool h3 { margin:0; font-size: 16px; }
    .tool a { color: var(--accent); text-decoration: none; word-break: break-word; }
    .muted { color: var(--muted); font-size: 13px; }
    .empty { color: var(--muted); padding: 12px; text-align: center; border:1px dashed #2a346b; border-radius: 10px; }
    .btn { border:1px solid #2a346b; background:#0b1230; color:var(--ink); padding:8px 12px; border-radius:10px; cursor:pointer; font-size: 14px; }
    .btn.primary { background: linear-gradient(180deg, #2a6bff, #2455d9); border-color:#2a6bff; }
    .btn.copy { padding: 4px 8px; font-size: 12px; border-radius: 6px; background: #1c244f; border: 1px solid #2a346b; cursor: pointer; }
    .btn.copy:hover { background: #263068; }
    .grid2 { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 560px){ .grid2 { grid-template-columns: 1fr 1fr; } }
    .pill { font-size: 12px; color:#c7cdf1; background:#1a2046; border:1px solid #2a346b; padding:4px 8px; border-radius:999px; }
    .hint { font-size: 12px; color:#98a2d7; margin-top: 6px; }
    .right { display:flex; gap:8px; align-items:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üß∞ My Tools Directory</h1>
      <div class="right">
        <span id="who" class="muted" style="font-size:12px;"></span>
        <button id="logoutBtn" class="btn">Logout</button>
      </div>
    </header>

    <div class="bar panel" style="margin-bottom:16px;">
      <div class="bd">
        <input id="search" type="text" placeholder="Search by name, description, or URL‚Ä¶" />
        <div class="hint">Tip: search is case-insensitive and matches partial words across all fields.</div>
      </div>
    </div>

    <div class="row">
      <section class="panel">
        <div class="hd">
          <strong>Results</strong>
          <span class="pill"><span id="count">0</span> tools</span>
        </div>
        <div class="bd">
          <div id="list" class="tools"></div>
          <div id="empty" class="empty" style="display:none">No tools yet. Add one on the right ‚Üí</div>
        </div>
      </section>

      <aside class="panel">
        <div class="hd"><strong>Add a Tool</strong></div>
        <div class="bd">
          <form id="toolForm" autocomplete="off">
            <div class="grid2">
              <div>
                <label class="muted">Tool name</label>
                <input id="name" type="text" required />
              </div>
              <div>
                <label class="muted">Tool URL</label>
                <input id="url" type="url" required />
              </div>
            </div>
            <div style="margin-top:10px">
              <label class="muted">Description</label>
              <textarea id="desc" required></textarea>
            </div>
            <div class="actions">
              <button class="btn primary" type="submit">Save</button>
            </div>
          </form>
        </div>
      </aside>
    </div>
  </div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyCr0mWqPpKagshNi52LmLkLU_xOKdlImo4",
  authDomain: "tools-directory-2e1b0.firebaseapp.com",
  projectId: "tools-directory-2e1b0",
  storageBucket: "tools-directory-2e1b0.firebasestorage.app",
  messagingSenderId: "922717661135",
  appId: "1:922717661135:web:816f2bca1b4cc0f3f994ba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const appWrap = document.querySelector('.wrap');
const who = document.getElementById('who');
const logoutBtn = document.getElementById('logoutBtn');
const els = {
  list: document.getElementById('list'),
  empty: document.getElementById('empty'),
  count: document.getElementById('count'),
  search: document.getElementById('search'),
  form: document.getElementById('toolForm'),
  name: document.getElementById('name'),
  url: document.getElementById('url'),
  desc: document.getElementById('desc')
};

// Login/Signup modal
const loginForm = document.createElement('form');
loginForm.innerHTML = `
  <div style="max-width:360px;margin:10vh auto;padding:20px;background:#121833;border-radius:12px;color:#e7eaf6">
    <h2>üîê Sign In or Register</h2>
    <input type="email" id="loginEmail" placeholder="Email" required /><br/><br/>
    <input type="password" id="loginPass" placeholder="Password" required /><br/><br/>
    <button type="submit" id="loginBtn" class="btn primary" style="width:100%;margin-bottom:6px;">Login</button>
    <button type="button" id="signupBtn" class="btn" style="width:100%;">Sign Up</button>
    <div id="loginError" style="color:#ff6b6b;font-size:13px;margin-top:8px;"></div>
  </div>
`;

function showLogin() {
  document.body.prepend(loginForm);
  appWrap.style.display = 'none';
  const emailEl = document.getElementById('loginEmail');
  const passEl = document.getElementById('loginPass');
  const errBox = document.getElementById('loginError');
  document.getElementById('loginBtn').onclick = async (e) => {
    e.preventDefault();
    try { await signInWithEmailAndPassword(auth, emailEl.value, passEl.value); }
    catch (err) { errBox.textContent = err.message; }
  };
  document.getElementById('signupBtn').onclick = async () => {
    try { await createUserWithEmailAndPassword(auth, emailEl.value, passEl.value); }
    catch (err) { errBox.textContent = err.message; }
  };
}

// Firestore
const toolsRef = collection(db, 'tools');
async function fetchTools() {
  const snapshot = await getDocs(toolsRef);
  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
}
async function addToolToFirestore(data) { await addDoc(toolsRef, data); }
async function deleteToolFromFirestore(id) { await deleteDoc(doc(db, 'tools', id)); }

// UI
function escapeHtml(s=''){ return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function itemTemplate(t) {
  const date = new Date(t.createdAt).toLocaleString();
  return `
    <article class="tool">
      <div style="display:flex; justify-content:space-between;">
        <h3>${escapeHtml(t.name)}</h3>
        <button class="btn ghost" data-del="${t.id}">üóëÔ∏è</button>
      </div>
      <div style="display:flex; align-items:center; gap:6px;">
        <a href="${t.url}" target="_blank">${t.url}</a>
        <button class="btn copy" onclick="navigator.clipboard.writeText('${t.url}')">Copy</button>
      </div>
      <div class="muted">${escapeHtml(t.desc)}</div>
      <div class="muted" style="font-size:12px">Added ${date}</div>
    </article>
  `;
}
async function render(query='') {
  const rows = await fetchTools();
  const q = query.toLowerCase();
  const filtered = q ? rows.filter(t=>t.name.toLowerCase().includes(q)||t.url.toLowerCase().includes(q)||t.desc.toLowerCase().includes(q)) : rows;
  els.count.textContent = filtered.length;
  els.empty.style.display = filtered.length ? 'none' : 'block';
  els.list.innerHTML = filtered.map(itemTemplate).join('');
  document.querySelectorAll('[data-del]').forEach(btn=>btn.onclick = async () => {
    if(confirm('Delete this entry?')) { await deleteToolFromFirestore(btn.dataset.del); render(els.search.value); }
  });
}

// Events
els.search.oninput = ()=>{ clearTimeout(window._t); window._t=setTimeout(()=>render(els.search.value),150); };
els.form.onsubmit = async (e) => {
  e.preventDefault();
  await addToolToFirestore({ name: els.name.value, url: els.url.value, desc: els.desc.value, createdAt: Date.now() });
  els.form.reset();
  render();
};
logoutBtn.onclick = () => signOut(auth);

// Auth
onAuthStateChanged(auth, (user) => {
  if(user) {
    loginForm.remove();
    appWrap.style.display = 'block';
    who.textContent = user.email;
    render();
  } else {
    who.textContent = '';
    showLogin();
  }
});
</script>
</body>
</html>
